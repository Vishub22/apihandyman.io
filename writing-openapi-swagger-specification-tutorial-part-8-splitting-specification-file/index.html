<!DOCTYPE html>
<html lang="en">

  


<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="apple-touch-icon" href="/images/favicons/favicon.png">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" href="/images/favicons/favicon.png">

  <title>Writing OpenAPI (Swagger) Specification Tutorial - Part 8 - Splitting specification file | API Handyman</title>
  <meta name="description" content="With previous posts we have learned to produce an OpenAPI specification containing all OpenAPI specification subtleties. Some specification files may become ...">

  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/bootstrap-toc.min.css">
  <link rel="canonical" href="/writing-openapi-swagger-specification-tutorial-part-8-splitting-specification-file/">
  <link rel="alternate" type="application/rss+xml" title="API Handyman" href="/feed.xml">
  <script type="text/javascript" src="/js/jquery.min.js" ></script>
  <script type="text/javascript" src="/js/gist-embed.min.js" ></script>
  <script type="text/javascript" src="/js/bootstrap.min.js" ></script>
  <script type="text/javascript" src="/js/anchor.min.js" ></script>
  <script type="text/javascript" src="/js/bootstrap-toc.min.js" ></script>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58046291-1', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>

  <body>
      <div class="container">
        <div class="row">
          <div class="col-xs-12 col-md-12">
            <!--<header>-->
  <!-- Static navbar -->
  <nav class="navbar navbar-fixed-top full">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <i class="fa fa-bars fa-2x" aria-hidden="true"></i>
        </button>
        <a class="navbar-brand" href="/">API Handyman</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          
          
            <li class="dropdown">
              <a href="#" class="page-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Series: Writing OpenAPI (Swagger) Specification Tutorial<span class="caret"></span></a>
              <ul class="dropdown-menu">
                
                    <li ><a class="page-link" href="/writing-openapi-swagger-specification-tutorial-part-1-introduction/">Part 1 - Introduction</a></li>
                
                    <li ><a class="page-link" href="/writing-openapi-swagger-specification-tutorial-part-2-the-basics/">Part 2 - The basics</a></li>
                
                    <li ><a class="page-link" href="/writing-openapi-swagger-specification-tutorial-part-3-simplifying-specification-file/">Part 3 - Simplifying specification file</a></li>
                
                    <li ><a class="page-link" href="/writing-openapi-swagger-specification-tutorial-part-4-advanced-data-modeling/">Part 4 - Advanced Data</a></li>
                
                    <li ><a class="page-link" href="/writing-openapi-swagger-specification-tutorial-part-5-advanced-input-and-output-modeling/">Part 5 - Advanced Input And Output Modeling</a></li>
                
                    <li ><a class="page-link" href="/writing-openapi-swagger-specification-tutorial-part-6-defining-security/">Part 6 - Defining Security</a></li>
                
                    <li ><a class="page-link" href="/writing-openapi-swagger-specification-tutorial-part-7-documentation/">Part 7 - Documentation</a></li>
                
                    <li  class="disabled" ><a class="page-link" href="/writing-openapi-swagger-specification-tutorial-part-8-splitting-specification-file/">Part 8 - Splitting specification file</a></li>
                
              </ul>
            </li>
          
          
            <li class="nav-item"><a class="page-link" href="/categories/posts">Posts</a></li>
          
            <li class="nav-item"><a class="page-link" href="/categories/talks">Talks</a></li>
          
            <li class="nav-item"><a class="page-link" href="/categories/elsewhere">Elsewhere</a></li>
          
          <li class="nav-item"><a class="page-link" href="/about/">About</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
  </nav>
<!--</header>-->
          </div>
        </div>
      </div>
      





<header>
  <!--<div class="container main-container full-jumbotron">-->
      <div class="jumbotron" style="background-image: url('/images/writing-openapi-swagger-specification-tutorial-part-8-splitting-specification-file/thumbnail.png')">
        <div class="header-caption text-center">
          <h1 class="post-title" itemprop="name headline">Part 8 - Splitting specification file</h1>
          
            <h2 class="post-subtitle">Writing OpenAPI (Swagger) Specification Tutorial</h2>
          
        </div>
      </div>
  <!--</div>-->
</header>
      <div class="container main-container">
        <div class = "row">
          <main>
          <div class="col-xs-12 col-sm-9 col-md-8 col-md-offset-2" role="main">
  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <div id="post" class="blog-container" itemprop="articleBody">
      <p class="post-meta">
        
          By
          <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Arnaud Lauret</span></span>&nbsp;&nbsp;|&nbsp;
        
        <time datetime="2016-08-02T21:45:17+02:00" itemprop="datePublished">Aug. 2, 2016</time><span>&nbsp;|&nbsp;posts</span>
      </p>
      <p>With <a href="(http://apihandyman.io/category/openapi-swagger-specification/)">previous posts</a> we have learned to produce an <a href="https://openapis.org/">OpenAPI specification</a> containing all OpenAPI specification subtleties. Some specification files may become quite large or may contain elements which could be reused in other APIs. Splitting a specification file will help to keep it maintainable by creating smaller files and also help to ensure consistency throughout APIs by sharing common elements.<!--more--></p>

<h1 id="writing-openapi-fka-swagger-specification-tutorial">Writing OpenAPI (fka Swagger) Specification tutorial</h1>
<p>This tutorial is composed of several posts:</p>

<ul>
  <li>Part 1: <a href="/writing-openapi-swagger-specification-tutorial-part-1-introduction/">Introduction</a></li>
  <li>Part 2: <a href="/writing-openapi-swagger-specification-tutorial-part-2-the-basics/">The basics</a></li>
  <li>Part 3: <a href="/writing-openapi-swagger-specification-tutorial-part-3-simplifying-specification-file/">Simplifying specification file</a></li>
  <li>Part 4: <a href="/writing-openapi-swagger-specification-tutorial-part-4-advanced-data-modeling/">Advanced data modeling</a></li>
  <li>Part 5: <a href="/writing-openapi-swagger-specification-tutorial-part-5-advanced-input-and-output-modeling/">Advanced input and output modeling</a></li>
  <li>Part 6: <a href="/writing-openapi-swagger-specification-tutorial-part-6-defining-security">Defining security</a></li>
  <li>Part 7: <a href="">Documentation</a></li>
  <li>Part 8: <strong>Splitting specification file</strong></li>
  <li>Part 9: Extending the OpenAPI specification (coming soon)</li>
</ul>

<p>In previous parts we’ve learned to create highly accurate API description which can become quite large or may contain elements that can be reused, in this eighth part we’ll learn how to split an OpenAPI specification file into smaller and reusable elements.</p>

<p>All tutorial’s files are available on <a href="https://gist.github.com/arno-di-loreto/5a3df2250721fb154060">gist</a>.</p>

<p>If you’re a bit lost in the <a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md">specification</a>, take a look at my [<em>visual documentation:</em></p>
<div>
      <img src="//images/writing-openapi-swagger-specification-tutorial/openapi-specification-visual-documentation.png" />
      <p class="img-label"><a href="http://openapi-specification-visual-documentation.apihandyman.io/">OpenAPI Specification Visual Documentation</a></p>
    </div>

<h1 id="json-pointers">JSON Pointers</h1>
<p>In <a href="http://apihandyman.io/writing-openapi-swagger-specification-tutorial-part-3-simplifying-specification-file/">part 3 - Simplifying spefication file</a> we have learned how to simplify the specification by creating reusable elements. In the example below, the <code class="highlighter-rouge">Person</code> definition is defined once in <code class="highlighter-rouge">definitions</code> and used as</p>

<ul>
  <li>A body parameter in <code class="highlighter-rouge">POST /persons</code></li>
  <li>A response schema in <code class="highlighter-rouge">GET /persons/{username}</code></li>
  <li>A sub-elements in <code class="highlighter-rouge">Persons</code> definition</li>
</ul>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_06_with_definitions.yaml" data-gist-highlight-line="65-74, 78, 60, 40" data-gist-footer="false"></code></p>

<p>To use the <code class="highlighter-rouge">Person</code> definition in these different places, we use a JSON Pointer (defined by <a href="https://tools.ietf.org/html/rfc6901">RFC6901</a>):</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_06_with_definitions.yaml" data-gist-line="78" data-gist-footer="false"></code></p>

<p>This pointer describes a path in the document, pointing to <code class="highlighter-rouge">Person</code> in <code class="highlighter-rouge">definitions</code> which is as the root (<code class="highlighter-rouge">#</code>) of the <em>current</em> document.</p>

<p>But JSON pointers are not only meant to point something <em>within</em> the current document, they can be used to reference something in <em>another</em> document.</p>

<h1 id="basic-splitting">Basic splitting</h1>

<p>Let’s see how we can split the <a href="https://gist.github.com/arno-di-loreto/5a3df2250721fb154060#file-simple_openapi_specification_06_with_definitions-yaml">file</a> we created in part 3</p>

<h2 id="referencing-a-local-file">Referencing a local file</h2>

<p>We can create a <code class="highlighter-rouge">person.yaml</code> file containing the <code class="highlighter-rouge">Person</code> definition:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_23_person.yaml" data-gist-footer="false"></code></p>

<p>Then we can remove the <code class="highlighter-rouge">Person</code> definition in <code class="highlighter-rouge">definitions</code> and replace all existing references to person <code class="highlighter-rouge">#definitions/Person</code> by a reference to <code class="highlighter-rouge">Person</code> in the <code class="highlighter-rouge">person.yaml</code> file:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_24_local_reference.yaml" data-gist-highlight-line="40, 60, 68" data-gist-footer="false"></code></p>

<h2 id="editing-splitted-local-files-with-the-online-editor">Editing splitted local files with the online editor</h2>
<p>Tools will look for the referenced file (<code class="highlighter-rouge">person.yaml</code>) in the same directory as the file containing the reference.
But when you use the <a href="http://editor.swagger.io">online editor</a> it does not make sense, such local reference cannot be resolved.</p>

<div>
      <img src="/images/writing-openapi-swagger-specification-tutorial-part-8-splitting-specification-file/openapi8-editor-error.png" />
      
    </div>

<p>Fortunately the editor propose a configuration allowing to set a server to resolve these local references. This configuration is accessible in the <em>Preferences-&gt;Preferences</em> menu:</p>

<div>
      <img src="/images/writing-openapi-swagger-specification-tutorial-part-8-splitting-specification-file/openapi8-editor-preferences.png" />
      
    </div>

<p>The <em>Pointer Resolution Base Path</em> configuration is on the bottom of the configuration screen:</p>

<div>
      <img src="/images/writing-openapi-swagger-specification-tutorial-part-8-splitting-specification-file/openapi8-editor-preferences-pointer-original.png" />
      
    </div>

<p>All you need to do is put the referenced yaml files into a web server (with <a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> activated) and modify the editor’s configuration to point this server.</p>

<h3 id="http-server-a-lightweight-web-server">http-server a lightweight web server</h3>
<p>You can use <a href="https://www.npmjs.com/package/http-server">http-server</a> a lightweight node.js web server:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">npm install --global http-server</code></pre></figure>

<p>You now can start a web service on any folder:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">http-server --cors path/to/yaml/folder</code></pre></figure>

<p>or</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nb">cd </span>path/to/yaml/folder
http-server --cors .</code></pre></figure>

<p>By default, <code class="highlighter-rouge">http-server</code> listens on 8080 port, files will be accessble through <code class="highlighter-rouge">http://localhost:8080/&lt;path to file within folder&gt;</code>.</p>

<p>The <code class="highlighter-rouge">--cors</code> flag is used to activate CORS directive and allow XHR request to this local webserver from the online editor page.
<strong>Without</strong> CORS activated, the editor will not be able to download files.</p>

<h3 id="modifying-online-editor-configuration">Modifying online editor configuration</h3>
<p>Once the web server is started you can modifiy the editor to set the URL to <code class="highlighter-rouge">http://localhost:8080/</code>:</p>

<div>
      <img src="/images/writing-openapi-swagger-specification-tutorial-part-8-splitting-specification-file/openapi8-editor-preferences-pointer-modified.png" />
      
    </div>

<p>Files referenced with <code class="highlighter-rouge">$ref: &lt;filename&gt;#/example</code> will be downloaded from  <code class="highlighter-rouge">http://localhost:8080/&lt;filename&gt;</code>.</p>

<p>Once this is done, you may need to do a force refresh (clean cache) of the editor’s the page to get the green bar.</p>

<div>
      <img src="/images/writing-openapi-swagger-specification-tutorial-part-8-splitting-specification-file/openapi8-editor-noerror.png" />
      
    </div>

<h3 id="cache">Cache</h3>

<p>When you add a reference to a new file (that was not already reference), this new file may not be downloaded automatically resulting in errors (<code class="highlighter-rouge">Reference could not be resolved: newfile.yaml</code>). You may need to refresh the editor’s page with cache cleaning to solve this error.</p>

<h2 id="folders">Folders</h2>

<p>You’re under no obligation to put all sub-files on a “root” level, you can store them in differents sub-folders.</p>

<h3 id="reference-to-a-file-in-a-folder">Reference to a file in a folder</h3>

<p>Let’s move the <code class="highlighter-rouge">person.yaml</code> file into a sub-folder <code class="highlighter-rouge">folder</code>, the new reference will be like this:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_25_local_reference_folder.yaml" data-gist-line="40" data-gist-footer="false"></code></p>

<h3 id="file-referencing-a-file-from-an-upper-folder">File referencing a file from an upper folder</h3>
<p>You can also reference a file outside the current folder. Let’s create a <code class="highlighter-rouge">persons.yaml</code> file into a <code class="highlighter-rouge">another-folder</code> folder:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_26_persons.yaml" data-gist-footer="false"></code></p>

<p>This file reference the <code class="highlighter-rouge">person.yaml</code> file using <code class="highlighter-rouge">..</code> to get to the upper level.</p>

<p>To use <code class="highlighter-rouge">persons.yaml</code>, we proceed just like with <code class="highlighter-rouge">person.yaml</code>. We remove the <code class="highlighter-rouge">Persons</code> definition from the main file and we replace its reference <code class="highlighter-rouge">#/definitions/Persons</code> by <code class="highlighter-rouge">another-folder/persons.yaml#Persons</code>.</p>

<p>Here’s the full file with all definitions externalized (the <code class="highlighter-rouge">definitions</code> section has been removed):
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_25_local_reference_folder.yaml" data-gist-highlight-line="31,40,60" data-gist-footer="false"></code></p>

<h2 id="referencing-a-remote-files">Referencing a remote files</h2>
<p>As you may have guess while modifying the references in the specification and editor configuration, it is also possible to reference a remote file.</p>

<h3 id="remote-files">Remote files</h3>
<p>All we need to do is to put the full file’s URL in the reference:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">$ref</span><span class="pi">:</span> <span class="s">https://myserver.com/mypath/myfile.yaml#/example</span></code></pre></figure>

<p>Remember that the server <strong>MUST</strong> have CORS activated to allow the editor to download the file.</p>

<p>We have launched a web server on 8080 port, so all we have to do is add <code class="highlighter-rouge">http://localhost:8080/</code> to the references to <code class="highlighter-rouge">Person</code>:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_27_remote_reference.yaml" data-gist-line="40" data-gist-footer="false"></code></p>

<h3 id="remote-files-containing-local-references">Remote files containing local references</h3>
<p>What happen if the remote file reference a local file? (<code class="highlighter-rouge">Main file -&gt; Remote file -&gt; Local file</code>).</p>

<p>The parser will seek this “local” file on the remote server providing the remote file.</p>

<p>If we replace the local to <code class="highlighter-rouge">Persons</code> by a remote reference…</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_27_remote_reference.yaml" data-gist-line="31" data-gist-footer="false"></code></p>

<p>… the <code class="highlighter-rouge">person.yaml</code> file referenced “locally” in the <code class="highlighter-rouge">persons.yaml</code> file will be loaded from <code class="highlighter-rouge">http://localhost:8080</code> which has served the <code class="highlighter-rouge">persons.yaml</code>.</p>

<h3 id="remote-files-containing-remote-references">Remote files containing remote references</h3>
<p>If a remote file contains a remote reference (<code class="highlighter-rouge">Main file -&gt; Remote file -&gt; Remote file
</code>), it will be resolved like in <em>2.4.1 Remote files</em>.</p>

<p>We can replace the <code class="highlighter-rouge">person.yaml</code> file local reference by a remote reference in <code class="highlighter-rouge">persons.yaml</code>:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_28_persons_remote.yaml" data-gist-footer="false"></code></p>

<h2 id="multiple-items-in-a-single-sub-file">Multiple items in a single sub-file</h2>
<p>We have put <code class="highlighter-rouge">Person</code> and <code class="highlighter-rouge">Persons</code> definitions in separate files: this is not an obligation. You can put more than one item in a single file, you only need to use the right JSON Pointer.</p>

<h3 id="person-and-person-in-a-single-file">Person and Person in a single file</h3>
<p>If we concatenate <code class="highlighter-rouge">person.yaml</code> and <code class="highlighter-rouge">persons.yaml</code> into a single file called <code class="highlighter-rouge">definitions.yaml</code>:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_29_definitions.yaml" data-gist-highlight-line="15" data-gist-footer="false"></code></p>

<p>Note that in <code class="highlighter-rouge">Persons</code> the reference to <code class="highlighter-rouge">Person</code> is now <code class="highlighter-rouge">#/Person</code>.</p>

<p>In the main file we only need to change the filename when reference these two definitions:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_30_subfile_multiple.yaml" data-gist-line="31" data-gist-footer="false"></code></p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_30_subfile_multiple.yaml" data-gist-line="40" data-gist-footer="false"></code></p>

<h3 id="organizing-content-in-a-sub-file">Organizing content in a sub-file</h3>
<p>Within the sub-file you can organize the content as you wish. Here <code class="highlighter-rouge">Person</code> is in <code class="highlighter-rouge">SomeDefinitions</code> and Persons is in <code class="highlighter-rouge">OtherDefinitions</code>:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_31_organized_definitions.yaml" data-gist-highlight-line="1,13,17" data-gist-footer="false"></code></p>

<p>Note that in <code class="highlighter-rouge">Persons</code> the reference to <code class="highlighter-rouge">Person</code> is now <code class="highlighter-rouge">#/SomeDefinitions/Person</code>.</p>

<p>In the main file we have to modify the path to get the item in the sub-file for these two definitions:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_32_subfile_organized.yaml" data-gist-line="31" data-gist-footer="false"></code></p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_32_subfile_organized.yaml" data-gist-line="40" data-gist-footer="false"></code></p>

<h2 id="definitions-responses-parameters">Definitions, Responses, Parameters</h2>
<p>What we have done with <code class="highlighter-rouge">Person</code> and <code class="highlighter-rouge">Persons</code> definitions can be done with any reusable items (i.e. using <code class="highlighter-rouge">$ref</code>) such as responses and parameters in the Open API Specification file.</p>

<h1 id="openapi-chainsaw-massacre">OpenAPI chainsaw massacre</h1>
<p>Thanks to <a href="http://azimi.me/2015/07/16/split-swagger-into-smaller-files.html">Mohsen Azimi’s post</a> I’ve discovered that using sub-files for definitions, responses and parameters which obviously use $ref JSON Pointers is not the only way of using sub-files. You can use sub-files for almost anything in the specification.</p>

<p>We will split the <a href="https://gist.github.com/arno-di-loreto/5a3df2250721fb154060#file-simple_openapi_specification_22_documentation_with_gfm-yaml">huge file</a> created in <a href="/writing-openapi-swagger-specification-tutorial-part-7-documentation/">previous post about documentation</a>.</p>

<h2 id="let-the-chainsaw-massacre-begin">Let the chainsaw massacre begin</h2>
<p>Let’s start with the <code class="highlighter-rouge">info</code> section:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_22_documentation_with_gfm.yaml" data-gist-line="1-25" data-gist-footer="false"></code></p>

<p>We can put its whole content in a file called <code class="highlighter-rouge">info.yaml</code>:
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_34_chainsaw_info.yaml" data-gist-footer="false"></code></p>

<p>And reference it just like this in <code class="highlighter-rouge">info</code>:
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_33_chainsaw.yaml" data-gist-line="1-4" data-gist-highlight-line="4" data-gist-footer="false"></code></p>

<h2 id="the-wizard-of-resolution">The wizard of resolution</h2>
<p>We can do the same thing with <code class="highlighter-rouge">paths</code>, <code class="highlighter-rouge">definitions</code>, <code class="highlighter-rouge">responses</code> and <code class="highlighter-rouge">parameters</code>: copy the section content in a sub-file (<a href="https://gist.github.com/arno-di-loreto/5a3df2250721fb154060#file-simple_openapi_specification_35_chainsaw_paths-yaml">paths.yaml</a>, <a href="https://gist.github.com/arno-di-loreto/5a3df2250721fb154060#file-simple_openapi_specification_36_chainsaw_definitions-yaml">definitions.yaml</a>, <a href="https://gist.github.com/arno-di-loreto/5a3df2250721fb154060#file-simple_openapi_specification_37_chainsaw_responses-yaml">responses.yaml</a> and <a href="https://gist.github.com/arno-di-loreto/5a3df2250721fb154060#file-simple_openapi_specification_38_chainsaw_parameters-yaml">parameters.yaml</a>) and reference it in the main file:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_33_chainsaw.yaml" data-gist-line="29-39" data-gist-highlight-line="30,33,36,39" data-gist-footer="false"></code></p>

<p>If you remember previous posts, these sections references each other in many ways, for example in <code class="highlighter-rouge">paths.yaml</code>:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_35_chainsaw_paths.yaml" data-gist-line="144-146" data-gist-highlight-line="146" data-gist-footer="false"></code></p>

<p>The <code class="highlighter-rouge">username</code> parameter is no longer in the main file and is not in the <code class="highlighter-rouge">paths.yaml</code> file but in the <code class="highlighter-rouge">parameters.yaml</code> file:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_38_chainsaw_parameters.yaml" data-gist-line="1-6" data-gist-highlight-line="1" data-gist-footer="false"></code></p>

<p>How could the main file be considered valid in the editor (or in any tool parsing the file)? It’s simply because the sub-files are loaded and then the whole content (file + sub-files) is validated.</p>

<h2 id="a-less-rough-split">A less rough split</h2>
<p>We can use JSON pointers for almost anything in the specification as as long as the $ref JSON pointer reference something corresponding to the expected object (or value) in the OpenAPI specification.</p>

<h3 id="referencing-object-in-custom-structure">Referencing object in custom structure</h3>
<p>And as seen earlier in this post we can put many items in a sub-file.</p>

<p>The <code class="highlighter-rouge">documentation.yaml</code> file contains the data for <code class="highlighter-rouge">externalDocs</code> and <code class="highlighter-rouge">tags</code> (note the custom structure on line 1 and 6):
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_39_chainsaw_documentation.yaml" data-gist-highlight-line="1,6" data-gist-footer="false"></code></p>

<p>These data are referenced this way in the main file:
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_33_chainsaw.yaml" data-gist-line="6-10" data-gist-highlight-line="7,10" data-gist-footer="false"></code></p>

<p>The <code class="highlighter-rouge">security.yaml</code> file contains the data for <code class="highlighter-rouge">securityDefinitions</code> and <code class="highlighter-rouge">security</code> (note the custom structure on line 20): 
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_41_chainsaw_security.yaml" data-gist-highlight-line="20" data-gist-footer="false"></code></p>

<h3 id="referencing-a-string-or-a-simple-list">Referencing a string or a simple list</h3>
<p>It also work for simpler value like a string or a list of string. The <code class="highlighter-rouge">schema</code>, <code class="highlighter-rouge">host</code> and <code class="highlighter-rouge">basepath</code> values can be moved into a single file <code class="highlighter-rouge">security.yaml</code> (note the custom structure on line 3 and 4):</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_39_chainsaw_endpoint.yaml" data-gist-highlight-line="3,4" data-gist-footer="false"></code></p>

<p>And referenced like this
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_33_chainsaw.yaml" data-gist-line="12-17" data-gist-highlight-line="13,15,17" data-gist-footer="false"></code></p>

<h3 id="reusing-a-value">Reusing a value</h3>
<p>As long as the API consumes and produces the same media types, we define a single value in the <code class="highlighter-rouge">mediatypes.yaml</code> file:
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_40_chainsaw_mediatypes.yaml" data-gist-footer="false"></code></p>

<p>And then we reference this single value in both <code class="highlighter-rouge">produces</code> and <code class="highlighter-rouge">consumes</code>: 
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_33_chainsaw.yaml" data-gist-line="19-22" data-gist-highlight-line="20,22" data-gist-footer="false"></code></p>

<h1 id="a-smarter-split">A smarter split</h1>
<p>The API we built with the previous parts could be divided in four parts:</p>

<ul>
  <li>Common items like headers, media types, security, definitions, parameters and responses</li>
  <li>Persons operations, parameters, responses and definitions</li>
  <li>Legacy operations</li>
  <li>Images operations</li>
</ul>

<p>We can create 4 sub-files and reference them from a main file.</p>

<h2 id="commonsyaml">commons.yaml</h2>
<p>In the <code class="highlighter-rouge">commons.yaml</code> file we put every items that can be reused across other files:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_43_smarter_commons.yaml" data-gist-footer="false"></code></p>

<h2 id="imagesyaml">images.yaml</h2>
<p>In the <code class="highlighter-rouge">images.yaml</code> file we put both <code class="highlighter-rouge">/images</code> and <code class="highlighter-rouge">/images/{id}</code> paths informations:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_44_smarter_images.yaml" data-gist-highlight-line="3,29,31,33,36,58,62,64,66" data-gist-footer="false"></code></p>

<p>Note that all references to common items point to <code class="highlighter-rouge">commons.yaml</code>.</p>

<h2 id="legacyyaml">legacy.yaml</h2>
<p>Same for the <code class="highlighter-rouge">/js-less-consumer-persons</code> path we put in <code class="highlighter-rouge">legacy.yaml</code> file in <code class="highlighter-rouge">js-less-consumer-persons</code>:
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_45_smarter_legacy.yaml" data-gist-highlight-line="3,42,46,50,52" data-gist-footer="false"></code></p>

<h2 id="personsyaml">persons.yaml</h2>
<p>All persons items go in the <code class="highlighter-rouge">persons.yaml</code>:</p>

<ul>
  <li>each path go in its own named section (like <code class="highlighter-rouge">persons-username</code> for <code class="highlighter-rouge">/persons/{username}</code>)</li>
  <li>all persons specific definitions goes in <code class="highlighter-rouge">definitions</code> (and can be referenced with <code class="highlighter-rouge">#definition/name</code>)</li>
  <li>all persons specific responses goes in <code class="highlighter-rouge">responses</code> (and can be referenced with <code class="highlighter-rouge">#responses/name</code>)</li>
  <li>all persons specific parameters goes in <code class="highlighter-rouge">parameters</code> (and can be referenced with <code class="highlighter-rouge">#parameters/name</code>)</li>
</ul>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_46_smarter_persons.yaml" data-gist-footer="false"></code></p>

<h2 id="full-main-file">full main file</h2>
<p>Here’s the full main file where we reference the 4 sub-files:
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_42_smarter.yaml" data-gist-footer="false"></code></p>

<h1 id="valid-sub-files">Valid sub-files</h1>
<p>If we put the last <a href="simple_openapi_specification_46_smarter_persons.yaml">persons.yaml</a> file content in the editor, it ends with these errors:</p>

<div>
      <img src="/images/writing-openapi-swagger-specification-tutorial-part-8-splitting-specification-file/openapi8-editor-subfile-error.png" />
      
    </div>

<p>Splitting a huge Open API Specification file to keep it maintainable is a great idea but if you cannot validate sub-files against the specification, you gain almost nothing.</p>

<h2 id="making-commonsyaml-valid">Making commons.yaml valid</h2>
<p>If we put the <a href="https://gist.github.com/arno-di-loreto/5a3df2250721fb154060#file-simple_openapi_specification_43_smarter_commons-yaml">commons.yaml</a> file created earlier in the editor we get these errors:</p>

<ul>
  <li>Missing required property: swagger</li>
  <li>Missing required property: info</li>
  <li>Missing required property: paths</li>
  <li>Additional properties not allowed: defaultHeaders,defaultMediatypes,defaultSecurity</li>
</ul>

<p>Let’s see how we can fix these errors.</p>

<h3 id="missing-swagger-property">Missing swagger property</h3>
<p>We just need to add this line on file’s top:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_48_valid_commons.yaml" data-gist-line="1" data-gist-footer="false"></code></p>

<h3 id="missing-info-property">Missing info property</h3>
<p>We add an short <code class="highlighter-rouge">info</code> section after <code class="highlighter-rouge">swagger</code>:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_48_valid_commons.yaml" data-gist-line="3-6" data-gist-footer="false"></code></p>

<h3 id="missing-paths-property">Missing paths property</h3>
<p>As we do not define any path in this file we just need to add an empty <code class="highlighter-rouge">paths</code> section:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_48_valid_commons.yaml" data-gist-line="39" data-gist-footer="false"></code></p>

<h3 id="property-defaultsecurity-not-allowed">Property defaultSecurity not allowed</h3>
<p>As the <code class="highlighter-rouge">defaultSecurity</code> correspond to the OpenAPI <code class="highlighter-rouge">security</code> section we just need to rename it:</p>

<p>Invalid <code class="highlighter-rouge">commons.yaml</code> file:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_43_smarter_commons.yaml" data-gist-line="20-23" data-gist-highlight-line="20" data-gist-footer="false"></code></p>

<p>Valid <code class="highlighter-rouge">commons.yaml</code> file:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_48_valid_commons.yaml" data-gist-line="28-31" data-gist-highlight-line="28" data-gist-footer="false"></code></p>

<h3 id="property-defaultmediatypes-not-allowed">Property defaultMediatypes not allowed</h3>
<p><code class="highlighter-rouge">defaultMediaType</code> is not a valid OpenAPI property:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_43_smarter_commons.yaml" data-gist-line="25-27" data-gist-highlight-line="25" data-gist-footer="false"></code></p>

<p>We will use <code class="highlighter-rouge">produces</code> and <code class="highlighter-rouge">consumes</code> to define the default media types. But as we want to define a single set of media type we will use this trick:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_48_valid_commons.yaml" data-gist-line="33-37" data-gist-highlight-line="37" data-gist-footer="false"></code></p>

<p>In the future if we want to define different sets of media types for produces and consumes, we’ll be ready.</p>

<h3 id="property-defaultheaders-not-allowed">Property defaultHeaders not allowed</h3>
<p><code class="highlighter-rouge">defaultHeaders</code> is not a valid OpenAPI property:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_43_smarter_commons.yaml" data-gist-line="29-36" data-gist-highlight-line="29" data-gist-footer="false"></code></p>

<p>We will use a dummy response definition <code class="highlighter-rouge">DefaultHeaders</code> to declare these default headers:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_48_valid_commons.yaml" data-gist-line="67-77" data-gist-highlight-line="71-77" data-gist-footer="false"></code></p>

<p>Of course we need to update common responses to use these headers:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_48_valid_commons.yaml" data-gist-line="78-87" data-gist-highlight-line="81,87" data-gist-footer="false"></code></p>

<h2 id="making-personsyaml-valid">Making persons.yaml valid</h2>
<p>Just like with <code class="highlighter-rouge">commons.yaml</code>, if we put <code class="highlighter-rouge">persons.yaml</code> content in the editor we get some errors:</p>

<ul>
  <li>Missing required property: swagger</li>
  <li>Missing required property: info</li>
  <li>Reference could not be resolved: commons.yaml#/defaultHeaders</li>
  <li>Missing required property: paths</li>
  <li>Additional properties not allowed: persons-username-collecting-items,persons-username-friends,persons-username,persons</li>
</ul>

<h3 id="missing-swagger-and-info-properties">Missing swagger and info properties</h3>
<p>We just add <code class="highlighter-rouge">swagger</code> and <code class="highlighter-rouge">info</code> like for <code class="highlighter-rouge">commons.yaml</code>:
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_49_valid_persons.yaml" data-gist-line="1-9" data-gist-footer="false"></code></p>

<h3 id="commonsyamldefaultheaders-reference-could-not-be-resolved">commons.yaml#/defaultHeaders reference could not be resolved</h3>
<p>As the <code class="highlighter-rouge">commons.yaml</code> structure has been modified concerning default headers we need to replace these references:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_46_smarter_persons.yaml" data-gist-line="21" data-gist-footer="false"></code></p>

<p>by this one:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_49_valid_persons.yaml" data-gist-line="32" data-gist-footer="false"></code></p>

<h3 id="missing-paths-and-additional-properties-not-allowed">Missing paths and additional properties not allowed</h3>
<p>We have defined custom properties for each path relative to <em>persons</em> operations, therefore there is no <code class="highlighter-rouge">paths</code> section and our custom properties (like <code class="highlighter-rouge">persons</code>) are not allowed by the OpenAPI specification.</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_46_smarter_persons.yaml" data-gist-line="1-7" data-gist-footer="false"></code></p>

<p>We need to add a <code class="highlighter-rouge">paths</code> section and put all our path in it using the correct path value as key:
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_49_valid_persons.yaml" data-gist-line="11-18" data-gist-footer="false"></code></p>

<h3 id="new-errors-security-definition-could-not-be-resolved">New errors: Security definition could not be resolved</h3>

<p>Once this is done, 2 new errors appear:</p>

<ul>
  <li>Security definition could not be resolved: OauthSecurity</li>
  <li>Security definition could not be resolved: LegacySecurity</li>
</ul>

<p>Now that we have a valid structure, the paths have been parsed and the parser detected missing security definitions. To solve this error, we add these definitions by referencing the <code class="highlighter-rouge">commons.yaml</code> file:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_49_valid_persons.yaml" data-gist-line="8-9" data-gist-footer="false"></code></p>

<h2 id="imagesyaml-and-legacyyaml">images.yaml and legacy.yaml</h2>
<p>For <code class="highlighter-rouge">images.yaml</code> and <code class="highlighter-rouge">legacy.yaml</code> we do exactly the same things as we’ve done with <code class="highlighter-rouge">persons.yaml</code>.</p>

<p>Here the <code class="highlighter-rouge">images.yaml</code> file modified (partial view):
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_51_valid_images.yaml" data-gist-line="1-12" data-gist-footer="false"></code></p>

<p>Here the <code class="highlighter-rouge">legacy.yaml</code> file modified (partial view):
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_52_valid_legacy.yaml" data-gist-line="1-12" data-gist-footer="false"></code></p>

<h2 id="updating-the-main-file">Updating the main file</h2>
<p>Now that we have modified all sub-files, if we try to edit the main file we get these errors</p>

<ul>
  <li>Reference could not be resolved: commons.yaml#/defaultMediatypes</li>
  <li>Reference could not be resolved: commons.yaml#/defaultSecurity</li>
  <li>Reference could not be resolved: persons.yaml#/persons</li>
  <li>Reference could not be resolved: images.yaml#/images-imageId</li>
  <li>Reference could not be resolved: persons.yaml#/persons-username</li>
  <li>Reference could not be resolved: persons.yaml#/persons-username-friends</li>
  <li>Reference could not be resolved: persons.yaml#/persons-username-collecting-items</li>
  <li>Reference could not be resolved: images.yaml#/images</li>
  <li>Reference could not be resolved: legacy.yaml#/js-less-consumer-persons</li>
</ul>

<p>These errors are of 2 types:</p>

<ul>
  <li>those due to the <code class="highlighter-rouge">commons.yaml</code> structure modification</li>
  <li>and those due to the <code class="highlighter-rouge">persons.yaml</code>, <code class="highlighter-rouge">images.yaml</code> and <code class="highlighter-rouge">legacy.yaml</code> paths structure modifications</li>
</ul>

<h3 id="modifiying-commonsyaml-references">Modifiying commons.yaml references</h3>
<p>Before:
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_42_smarter.yaml" data-gist-line="59-68" data-gist-highlight-line="60,62,68" data-gist-footer="false"></code></p>

<p>After:
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_47_valid.yaml" data-gist-line="59-68" data-gist-highlight-line="60,62,68" data-gist-footer="false"></code></p>

<h3 id="modifying-paths-references">Modifying paths references</h3>
<p>This is the trickyest part of this tutorial. To reference the <code class="highlighter-rouge">/persons</code> path in <code class="highlighter-rouge">persons.yaml</code> we used <code class="highlighter-rouge">persons.yaml#/persons</code>:</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_42_smarter.yaml" data-gist-line="70-72" data-gist-highlight-line="72" data-gist-footer="false"></code></p>

<p>But <code class="highlighter-rouge">persons.yaml</code> structure has changed from :</p>

<p><code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_46_smarter_persons.yaml" data-gist-line="1-7" data-gist-footer="false"></code></p>

<p>to:
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_49_valid_persons.yaml" data-gist-line="11-18" data-gist-footer="false"></code></p>

<p>The new reference should be something like <code class="highlighter-rouge">persons.yaml#/paths//persons</code> but if we try it, the editor shows an error <em>Reference could not be resolved: persons.yaml#/paths//persons</em>. The <code class="highlighter-rouge">/</code> in <code class="highlighter-rouge">/persons</code> needs to be escaped, how can we do that?</p>

<blockquote>
  <p>Evaluation of each reference token begins by decoding any escaped character sequence.  This is performed by first transforming any occurrence of the sequence ‘~1’ to ‘/’
<em><a href="https://tools.ietf.org/html/rfc6901">RFC6901</a></em></p>
</blockquote>

<p>Before modification:
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_42_smarter.yaml" data-gist-line="70-84" data-gist-highlight-line="72,74,76,78,80,82,84" data-gist-footer="false"></code></p>

<p>After modification (all <code class="highlighter-rouge">/</code> in reference name have been replaced by <code class="highlighter-rouge">~1</code>):
<code data-gist-id="5a3df2250721fb154060" data-gist-file="simple_openapi_specification_47_valid.yaml" data-gist-line="70-84" data-gist-highlight-line="72,74,76,78,80,82,84" data-gist-footer="false"></code></p>

<p>And now the main file and all its sub-files are considered valid by the editor.</p>

<h1 id="conclusion">Conclusion</h1>
<p>You are now ready to split any OpenAPI specification file into valid sub-files in any possible ways. In this 8th part you’ve learned how to use JSON pointers in almost any places in an OpenAPI specification to references items from other files and how to create valid sub-files containing partial informations. In the next final part (at last) we will learn how to extend the OpenAPI specification (coming soon).</p>

      
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://apihandyman.io/writing-openapi-swagger-specification-tutorial-part-8-splitting-specification-file/';
      this.page.identifier = 'http://apihandyman.io/writing-openapi-swagger-specification-tutorial-part-8-splitting-specification-file/';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://apihandyman.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


    </div>
    <script language="JavaScript">
        anchors.options = {
          placement: 'left'
        };
        anchors.add('.blog-container h1');
        anchors.add('.blog-container h2');
        anchors.add('.blog-container h3');
    </script>
  </article>
</div>
<div class="hidden-xs col-sm-3 col-md-2" role="complementary">
  <nav id="toc" data-spy="affix" data-offset-top="400"></nav>
  <script language="javascript">
    $(function() {
      console.log('here');
      var $myNav = $('#toc');
      var $myScope = $('#post');
      Toc.init({
        $nav: $myNav,
        $scope: $myScope
      });
      $('body').scrollspy({
        target: '#toc'
      });
    });
  </script>
</div>
          </main>
        </div>
      </div>
      <div class="container">
        <div class="row">
          <div class="col-xs-12 col-md-12">
            <footer>
  <nav class="navbar navbar-fixed-bottom">
    <ul class="list-inline">
     <li>
       <a href="/feed.xml"><i class="fa fa-rss fa-2x" aria-hidden="true"></i></a>
     </li>
     <li>
      <a href="https://twitter.com/apihandyman"><i class="fa fa-twitter fa-2x" aria-hidden="true"></i></a>   
     </li>
     <li>
      <a href="https://github.com/arno-di-loreto"><i class="fa fa-github fa-2x" aria-hidden="true"></i></a>   
     </li>
     <li>
      <a href="https://www.linkedin.com/in/arnaudlauret"><i class="fa fa-linkedin fa-2x" aria-hidden="true"></i></a>   
     </li>
    </ul>
  </nav>
</footer>
          </div>
        </div>
      </div>
  </body>

</html>